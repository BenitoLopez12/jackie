<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Confirmación | Jacqueline Moncayo</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <header>
      <div class="navbar">
        <ul>
          <li><a href="index.html">INICIO</a></li>
          <!-- <li><a href="best.html">MÁS VENDIDOS</a></li> -->
          <li><a href="shop.html">TIENDA</a></li>
          <li><a href="about.html">NOSOTROS</a></li>
        </ul>
        <div class="logo" style="text-align: center;">
          <img src="img/logo.webp" alt="Logo" style="height: 60px;" />
        </div>
      </div>
    </header>
    <div class="hero"></div>
    <main class="content">
      <h1 style="margin-bottom: 12px;">Gracias por tu compra</h1>
      <hr />

      <section class="product-detail-container" style="margin-top: 20px;">
        <div class="product-images">
          <div id="confirmContainer"><!-- items se renderizan aquí --></div>
        </div>

        <div class="product-details-info">
          <div id="confirmSummary" style="padding-top: 20px;"></div>
        </div>
      </section>
    </main>

    <footer>
      <div style="display: flex; justify-content: space-between; width: 100%;">
        <div class="footer-links">
          <a href="#">TABLA DE TALLAS</a>
          <a href="#">ENVÍOS</a>
          <a href="#">SÍGUENOS EN IG</a>
        </div>
        <div class="footer-links" style="align-items: flex-end;">
          <a href="#">CONTACTO</a>
          <a href="#">JAQUELINEMONCAYOMKY@GMAIL.COM</a>
          <a href="#">WhatsApp (593) 93 914 3035</a>
        </div>
      </div>
      <div class="copyright">
        COPYRIGHT © 2025 JACQUELINE MONCAYO. Todos los derechos reservados.
      </div>
    </footer>

    <script src="https://unpkg.com/lenis@1.3.11/dist/lenis.min.js"></script>
    <script src="script.js"></script>
    <script>
      function formatPrice(n) {
        return "$" + n.toFixed(2);
      }

      // Build printable ticket content (for main element)
      function buildTicketContent(order, subtotal, shipping, total) {
        const itemsRows = order.items
          .map(
            (i) => `
            <tr>
              <td style="padding:8px;border-bottom:1px solid #eee;"><img src="${
                i.img
              }" style="width:48px;height:48px;object-fit:cover;"/></td>
              <td style="padding:8px;border-bottom:1px solid #eee;">${
                i.producto
              }</td>
              <td style="padding:8px;border-bottom:1px solid #eee;">${
                i.size
              }</td>
              <td style="padding:8px;border-bottom:1px solid #eee;">${
                i.qty
              }</td>
              <td style="padding:8px;border-bottom:1px solid #eee;text-align:right;">${formatPrice(
                i.price * i.qty,
              )}</td>
            </tr>
          `,
          )
          .join("");

        return `
          <style>
            body{font-family:Arial,Helvetica,sans-serif;color:#222;padding:20px}
            h2{margin-bottom:4px}
            table{width:100%;border-collapse:collapse}
            td{vertical-align:middle}
            @media screen { header, footer, .hero { display: none; } }
            @media print { header, footer, .hero { display: none; } body { padding: 0; } }
          </style>
          <h2>Ticket de compra</h2>
          <div>Orden: <strong>${order.id}</strong></div>
          <div>Fecha: ${new Date(order.date).toLocaleString()}</div>
          <hr/>
          <table>
            <thead>
              <tr>
                <th style="text-align:left;padding:8px">Imagen</th>
                <th style="text-align:left;padding:8px">Producto</th>
                <th style="text-align:left;padding:8px">Talla</th>
                <th style="text-align:left;padding:8px">Cant</th>
                <th style="text-align:right;padding:8px">Subtotal</th>
              </tr>
            </thead>
            <tbody>
              ${itemsRows}
            </tbody>
          </table>
          <hr/>
          <div style="display:flex;justify-content:space-between;max-width:400px;margin-top:12px;"><div>Subtotal</div><div>${formatPrice(
            subtotal,
          )}</div></div>
          <div style="display:flex;justify-content:space-between;max-width:400px;"><div>Envío</div><div>${formatPrice(
            shipping,
          )}</div></div>
          <div style="display:flex;justify-content:space-between;font-weight:700;max-width:400px;margin-top:8px;"><div>Total</div><div>${formatPrice(
            total,
          )}</div></div>
          <hr/>
          <div>Enviado a:<br/>${order.customer.name}<br/>${
          order.customer.address
        }<br/>${order.customer.city}, ${order.customer.country}</div>
        `;
      }

      function renderConfirmation() {
        const order = JSON.parse(localStorage.getItem("lastOrder") || "null");
        const left = document.getElementById("confirmContainer");
        const right = document.getElementById("confirmSummary");
        left.innerHTML = "";
        right.innerHTML = "";

        if (!order) {
          left.innerHTML =
            '<p>No se encontró ninguna orden reciente.</p><p><a href="shop.html" class="btn btn-outline">Ir a la tienda</a></p>';
          return;
        }

        // Items list (left column)
        const itemsHtml = order.items
          .map(
            (i) => `
          <div style="display:flex;gap:12px;align-items:center;margin-bottom:8px;padding:12px;border:1px solid #eee;border-radius:6px;background:#fff;">
            <img src="${
              i.img
            }" style="width:84px;height:84px;object-fit:cover;"/>
            <div style="flex:1;">
              <div style="font-weight:600;">${i.producto}</div>
              <div style="color:#666;margin-top:6px;">Talla: ${i.size} x ${
              i.qty
            }</div>
            </div>
            <div style="text-align:right;min-width:100px;">${formatPrice(
              i.price * i.qty,
            )}</div>
          </div>
        `,
          )
          .join("");

        left.innerHTML = itemsHtml;

        // Summary (right column)
        const subtotal = order.items.reduce((s, i) => s + i.price * i.qty, 0);
        const shipping = subtotal > 0 ? 10 : 0;
        const total = subtotal + shipping;

        right.innerHTML = `
          <div style="font-weight:600;margin-bottom:12px;">Número de orden</div>
          <div style="margin-bottom:12px;"><strong>${order.id}</strong></div>
          <div style="display:flex;justify-content:space-between;margin-bottom:6px;"><div>Subtotal</div><div>${formatPrice(
            subtotal,
          )}</div></div>
          <div style="display:flex;justify-content:space-between;margin-bottom:12px;"><div>Envío</div><div>${formatPrice(
            shipping,
          )}</div></div>
          <div style="display:flex;justify-content:space-between;margin-bottom:16px;font-weight:700;"><div>Total</div><div>${formatPrice(
            total,
          )}</div></div>
          <div style="margin-bottom:12px;">Enviado a:<br/>${
            order.customer.name
          }<br/>${order.customer.address}<br/>${order.customer.city}, ${
          order.customer.country
        }</div>
          <div style="display:flex;gap:8px;">
            <a href="shop.html" class="btn btn-outline">Seguir comprando</a>
            <a href="index.html" class="btn btn-primary" style="margin-left:8px;">Inicio</a>
            <button id="printTicket" class="btn btn-outline" style="margin-left:8px;">Imprimir ticket</button>
          </div>
        `;

        // Attach print button
        const printBtn = document.getElementById("printTicket");
        if (printBtn) {
          printBtn.addEventListener("click", () => {
            const main = document.querySelector("main");
            const originalContent = main.innerHTML;
            const ticketContent = buildTicketContent(
              order,
              subtotal,
              shipping,
              total,
            );
            main.innerHTML = ticketContent;
            window.print();
            setTimeout(() => {
              main.innerHTML = originalContent;
            }, 1000);
          });
        }
      }

      renderConfirmation();
    </script>
  </body>
</html>
